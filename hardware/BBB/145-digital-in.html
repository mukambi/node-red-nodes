<!--
  Copyright 2014 Maxwell R Hadley

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- Edit dialog for discrete-in -->
<script type="text/x-red" data-template-name="discrete-in">
   <div class="form-row">
	   <label for="node-input-pin"><i class="icon-asterisk"></i>Input pin</label>
	   <select type="text" id="node-input-pin" style="width: 200px;">
		   <option value="">select pin</option>
		   <option value="P8_7">GPIO2_2 (P8 pin 7)</option>
		   <option value="P8_8">GPIO2_3 (P8 pin 8)</option>
		   <option value="P8_9">GPIO2_5 (P8 pin 9)</option>
		   <option value="P8_10">GPIO2_4 (P8 pin 10)</option>
		   <option value="P8_11">GPIO1_13 (P8 pin 11)</option>
		   <option value="P8_12">GPIO1_12 (P8 pin 12)</option>
		   <option value="P8_13">GPIO0_23 (P8 pin 13)</option>
		   <option value="P8_14">GPIO0_26 (P8 pin 14)</option>
		   <option value="P8_15">GPIO1_15 (P8 pin 15)</option>
		   <option value="P8_16">GPIO1_14 (P8 pin 16)</option>
		   <option value="P8_17">GPIO0_27 (P8 pin 17)</option>
		   <option value="P8_18">GPIO2_1 (P8 pin 18)</option>
		   <option value="P8_19">GPIO0_22 (P8 pin 19)</option>
		   <option value="P8_26">GPIO1_29 (P8 pin 26)</option>
		   <option value="P9_11">GPIO0_30 (P9 pin 11)</option>
		   <option value="P9_12">GPIO1_28 (P9 pin 12)</option>
		   <option value="P9_13">GPIO0_31 (P9 pin 13)</option>
		   <option value="P9_14">GPIO1_18 (P9 pin 14)</option>
		   <option value="P9_15">GPIO1_16 (P9 pin 15)</option>
		   <option value="P9_16">GPIO1_19 (P9 pin 16)</option>
		   <option value="P9_17">GPIO0_5 (P9 pin 17)</option>
		   <option value="P9_18">GPIO0_4 (P9 pin 18)</option>
		   <option value="P9_21">GPIO0_3 (P9 pin 21)</option>
		   <option value="P9_22">GPIO0_2 (P9 pin 22)</option>
		   <option value="P9_23">GPIO1_17 (P9 pin 23)</option>
		   <option value="P9_24">GPIO0_15 (P9 pin 24)</option>
		   <option value="P9_26">GPIO0_14 (P9 pin 26)</option>
		   <option value="P9_27">GPIO3_19 (P9 pin 27)</option>
		   <option value="P9_30">GPIO3_16 (P9 pin 30)</option>
		   <option value="P9_41">GPIO0_20 (P9 pin 41)</option>
		   <option value="P9_42">GPIO0_7 (P9 pin 42)</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-input-activeLow">Active low</label>
		<input type="checkbox" id="node-input-activeLow" style="display:inline-block; width:auto; vertical-align:top;">
	</div>
	<div class="form-row">
		<label for="node-input-debounce">Debounce</label>
		<input type="checkbox" id="node-input-debounce" style="display:inline-block; width:auto; vertical-align:top;">
	</div>
    <div class="form-row">
		<label for="node-input-updateInterval"><i class="icon-repeat"></i> Update at</label>
		<input id="node-input-updateInterval" type="text" style="width: 65px">
		<label>sec intervals</label>
	</div>
    <div class="form-row">
        <label for="node-input-topic"><i class="icon-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<!-- Help text for discrete-in -->
<script type="text/x-red" data-help-name="discrete-in">
<p>
Discrete input for the Beaglebone Black. Sends a message with payload 0 or 1 on the
first output each time the pin changes state, and logs the total time in the active state.
</p>
<p>
The node periodically sends a message with a payload of the current total active time
(in seconds) on the second output at selectable intervals. An input message with topic 'load'
and a numeric payload will set the total active time to that value: any other input message
will reset it to zero.
</p>
<p>
The active state may be set to be high or low: this only affects the calculation
of the active time, not the pin state value sent on the first output.
</p>
</script>

<!-- Register discrete-in -->
<script type="text/javascript">
    RED.nodes.registerType('discrete-in', {
        category: 'advanced-input', // the palette category
		color:"#c6dbef",
        defaults: {             	// defines the editable properties of the node
			pin: { value:"", required:true },
			activeLow: { value:false, required:true },
			debounce: { value:false, required: true },
			updateInterval: { value:60, required:true, validate:RED.validators.number() },
            topic: { value:"" },
            name: { value:"" }
        },
        inputs:1,                	// set the number of inputs - only 0 or 1
        outputs:2,               	// set the number of outputs - 0 to n
        icon: "arrow-in.png",    	// set the icon (held in public/icons)
        label: function() {      	// sets the default label contents
            return this.name || "discrete-in: " + this.pin;
        },
        labelStyle: function() { 	// sets the class to apply to the label
            return this.name ? "node_label_italic" : "";
        }
    });
</script>

<!-- Edit dialog for pulse-in -->
<script type="text/x-red" data-template-name="pulse-in">
   <div class="form-row">
	   <label for="node-input-pin"><i class="icon-asterisk"></i>Input pin</label>
	   <select type="text" id="node-input-pin" style="width: 200px;">
		   <option value="">select pin</option>
		   <option value="P8_7">GPIO2_2 (P8 pin 7)</option>
		   <option value="P8_8">GPIO2_3 (P8 pin 8)</option>
		   <option value="P8_9">GPIO2_5 (P8 pin 9)</option>
		   <option value="P8_10">GPIO2_4 (P8 pin 10)</option>
		   <option value="P8_11">GPIO1_13 (P8 pin 11)</option>
		   <option value="P8_12">GPIO1_12 (P8 pin 12)</option>
		   <option value="P8_13">GPIO0_23 (P8 pin 13)</option>
		   <option value="P8_14">GPIO0_26 (P8 pin 14)</option>
		   <option value="P8_15">GPIO1_15 (P8 pin 15)</option>
		   <option value="P8_16">GPIO1_14 (P8 pin 16)</option>
		   <option value="P8_17">GPIO0_27 (P8 pin 17)</option>
		   <option value="P8_18">GPIO2_1 (P8 pin 18)</option>
		   <option value="P8_19">GPIO0_22 (P8 pin 19)</option>
		   <option value="P8_26">GPIO1_29 (P8 pin 26)</option>
		   <option value="P9_11">GPIO0_30 (P9 pin 11)</option>
		   <option value="P9_12">GPIO1_28 (P9 pin 12)</option>
		   <option value="P9_13">GPIO0_31 (P9 pin 13)</option>
		   <option value="P9_14">GPIO1_18 (P9 pin 14)</option>
		   <option value="P9_15">GPIO1_16 (P9 pin 15)</option>
		   <option value="P9_16">GPIO1_19 (P9 pin 16)</option>
		   <option value="P9_17">GPIO0_5 (P9 pin 17)</option>
		   <option value="P9_18">GPIO0_4 (P9 pin 18)</option>
		   <option value="P9_21">GPIO0_3 (P9 pin 21)</option>
		   <option value="P9_22">GPIO0_2 (P9 pin 22)</option>
		   <option value="P9_23">GPIO1_17 (P9 pin 23)</option>
		   <option value="P9_24">GPIO0_15 (P9 pin 24)</option>
		   <option value="P9_26">GPIO0_14 (P9 pin 26)</option>
		   <option value="P9_27">GPIO3_19 (P9 pin 27)</option>
		   <option value="P9_30">GPIO3_16 (P9 pin 30)</option>
		   <option value="P9_41">GPIO0_20 (P9 pin 41)</option>
		   <option value="P9_42">GPIO0_7 (P9 pin 42)</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-input-countType">Count</label>
		<select type="text" id="node-input-countType" style="width: 100px;">
			<option value="pulse">pulses</option>
			<option value="edge">edges</option>
		</select>
	</div>
    <div class="form-row">
		<label for="node-input-countUnit">Scaling</label>
		<input id="node-input-countUnit" type="text" style="width: 65px">
		<label style="width: 60%"> units per count</label>
	</div>
    <div class="form-row">
		<label for="node-input-countRate">Rate</label>
		<input id="node-input-countRate" type="text" style="width: 65px">
		<label style="width: 60%"> units per count/second</label>
	</div>
    <div class="form-row">
		<label for="node-input-updateInterval"><i class="icon-repeat"></i> Update at</label>
		<input id="node-input-updateInterval" type="text" style="width: 65px">
		<label>sec intervals</label>
	</div>
    <div class="form-row">
        <label for="node-input-topic"><i class="icon-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<!-- Help text for pulse-in -->
<script type="text/x-red" data-help-name="pulse-in">
<p>
Pulse input for the Beaglebone Black. Counts input pulses or pulse edges, outputs
the total counts and the rate of counts/second, each with scaling applied.
</p>
<p>
Sends the total count message on the first output, and the current count
rate message on the second output, at the chosen interval. An input message with topic 'load'
and a numeric payload will set the total count to that value (no scaling is applied):
any other input message will reset it to zero.
</p>
</script>

<!-- Register pulse-in -->
<script type="text/javascript">
    RED.nodes.registerType('pulse-in', {
        category: 'advanced-input', // the palette category
		color:"#c6dbef",
        defaults: {             	// defines the editable properties of the node
			pin: { value:"", required:true },
			countType: { value:"pulse", required:true },
			countUnit: { value:1, required:true, validate:RED.validators.number() },
			countRate: { value:1, required:true, validate:RED.validators.number() },
			updateInterval: { value:2, required:true, validate:RED.validators.number() },
            topic: { value:"" },
            name: { value:"" }
        },
        inputs:1,                	// set the number of inputs - only 0 or 1
        outputs:2,               	// set the number of outputs - 0 to n
        icon: "arrow-in.png",    	// set the icon (held in public/icons)
        label: function() {      	// sets the default label contents
            return this.name || "pulse-in: " + this.pin;
        },
        labelStyle: function() { 	// sets the class to apply to the label
            return this.name ? "node_label_italic" : "";
        }
    });
</script>

